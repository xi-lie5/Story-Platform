<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <!-- 头部内容与index.html完全一致 -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>注册 - StoryForge</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- 使用cdnjs的Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script>
    tailwind.config = { /* 与index.html完全一致 */ }
  </script>
  <style type="text/tailwindcss">
    @layer utilities { /* 与index.html完全一致 */ }
    @keyframes float { /* 与index.html完全一致 */ }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen text-slate-800 font-sans">
  <!-- 导航栏：与index.html完全一致 -->
  <header class="fixed top-0 left-0 right-0 z-50 transition-all duration-300" id="navbar">
    <!-- 复制index.html的header代码 -->
  </header>

  <!-- 注册内容区域（核心替换部分） -->
  <section class="pt-32 pb-20 px-4">
    <div class="container mx-auto max-w-4xl">
      <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
        <div class="grid grid-cols-1 md:grid-cols-2">
          <!-- 左侧表单区域 -->
          <div class="p-8 md:p-12">
            <div class="mb-8">
              <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mb-4">
                <i class="fa fa-user-plus text-primary text-2xl"></i>
              </div>
              <h2 class="text-2xl md:text-3xl font-display font-bold">创建账号</h2>
              <p class="text-slate-600 mt-2">加入StoryForge，开启AI创作之旅</p>
            </div>

            <!-- 注册表单（仅框架） -->
            <form class="space-y-6">
              <div>
                <label for="reg-name" class="block text-sm font-medium text-slate-700 mb-2">用户名</label>
                <input type="text" id="reg-name" class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="请输入用户名" required>
              </div>
              <div>
                <label for="reg-email" class="block text-sm font-medium text-slate-700 mb-2">电子邮箱</label>
                <input type="email" id="reg-email" class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="请输入电子邮箱" required>
              </div>
              <div>
                <label for="reg-password" class="block text-sm font-medium text-slate-700 mb-2">密码</label>
                <input type="password" id="reg-password" class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="至少8位字符，包含字母和数字" required>
              </div>
              <div>
                <label for="reg-confirm" class="block text-sm font-medium text-slate-700 mb-2">确认密码</label>
                <input type="password" id="reg-confirm" class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="再次输入密码" required>
              </div>
              <div class="flex items-start">
                <input type="checkbox" id="reg-agree" class="w-4 h-4 mt-1 text-primary focus:ring-primary/50 border-slate-300 rounded" required>
                <label for="reg-agree" class="ml-2 text-sm text-slate-600">
                  我同意<a href="terms.html" class="text-primary hover:underline">服务条款</a>和<a href="privacy.html" class="text-primary hover:underline">隐私政策</a>
                </label>
              </div>
              <button type="submit" class="w-full py-3 rounded-lg bg-primary text-white font-medium shadow-md shadow-primary/20 hover:shadow-lg hover:shadow-primary/30 hover:bg-primary/90 transition-all">
                免费注册
              </button>
              <div class="text-center text-sm text-slate-600">
                已有账号？<a href="login.html" class="text-primary font-medium hover:underline">立即登录</a>
              </div>
            </form>
          </div>

          <!-- 右侧装饰区域（与原页面风格一致） -->
          <div class="hidden md:block relative">
            <img src="https://picsum.photos/id/1082/600/800" alt="创意灵感" class="absolute inset-0 w-full h-full object-cover">
            <div class="absolute inset-0 bg-gradient-to-r from-primary/80 to-secondary/80 flex items-center justify-center p-12">
              <div class="text-white text-center space-y-6">
                <i class="fa fa-lightbulb-o text-6xl animate-pulse-slow"></i>
                <h3 class="text-2xl font-bold">释放你的创造力</h3>
                <p>加入10,000+创作者社区，与AI协作生成无限可能的故事</p>
                <ul class="text-left space-y-3">
                  <li class="flex items-center"><i class="fa fa-check-circle mr-2"></i> 实时AI协作创作</li>
                  <li class="flex items-center"><i class="fa fa-check-circle mr-2"></i> 多结局分支故事</li>
                  <li class="flex items-center"><i class="fa fa-check-circle mr-2"></i> 场景自动可视化</li>
                  <li class="flex items-center"><i class="fa fa-check-circle mr-2"></i> 免费使用基础功能</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 页脚：与index.html完全一致 -->
  <footer class="bg-slate-900 text-white py-12 px-4">
    <!-- 复制index.html的footer代码 -->
  </footer>

  <!-- JavaScript：与index.html完全一致 -->
  <script>
    // 复制index.html的JavaScript代码
  </script>
  
  <!-- 注册功能脚本 -->
  <script>
  // 注册功能的JavaScript代码

  // 表单提交处理
  document.querySelector('form').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // 获取表单数据
    const username = document.getElementById('reg-name').value;
    const email = document.getElementById('reg-email').value;
    const password = document.getElementById('reg-password').value;
    const confirmPassword = document.getElementById('reg-confirm').value;
    const agreeTerms = document.getElementById('reg-agree').checked;
    
    // 表单验证
    if (!agreeTerms) {
      alert('请同意服务条款和隐私政策');
      return;
    }
    
    try {
      // 发送注册请求到后端API
      const response = await fetch('http://localhost:5000/api/v1/auth/register', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          username,
          email,
          password,
          confirmPassword
        })
      });
      
      const result = await response.json();
      
      if (result.success) {
        // 注册成功，保存token并跳转到登录页或首页
        localStorage.setItem('token', result.data.token);
        localStorage.setItem('refreshToken', result.data.refreshToken);
        localStorage.setItem('userInfo', JSON.stringify({
          userId: result.data.userId,
          username: result.data.username,
          email: result.data.email,
          avatar: result.data.avatar
        }));
        
        alert('注册成功！即将跳转到登录页');
        window.location.href = 'login.html';
      } else {
        // 显示错误信息
        let errorMsg = '注册失败';
        if (result.errors && result.errors.length > 0) {
          errorMsg = result.errors.map(err => err.message || err).join('\n');
        } else if (result.message) {
          errorMsg = result.message;
        }
        alert(errorMsg);
      }
    } catch (error) {
      console.error('注册请求失败:', error);
      alert('网络错误，请稍后重试');
    }
  });

  // 密码强度验证
  const passwordInput = document.getElementById('reg-password');
  passwordInput.addEventListener('input', function() {
    const password = this.value;
    const requirements = [];
    
    if (password.length >= 8) {
      requirements.push('✓ 长度符合要求');
    } else {
      requirements.push('✗ 长度至少8位');
    }
    
    if (/[A-Za-z]/.test(password) && /[0-9]/.test(password)) {
      requirements.push('✓ 包含字母和数字');
    } else {
      requirements.push('✗ 必须包含字母和数字');
    }
    
    // 创建或更新密码要求提示
    let passwordTips = document.getElementById('password-tips');
    if (!passwordTips) {
      passwordTips = document.createElement('div');
      passwordTips.id = 'password-tips';
      passwordTips.className = 'text-sm text-slate-600 mt-1';
      this.parentNode.appendChild(passwordTips);
    }
    
    passwordTips.innerHTML = requirements.join('<br>');
  });

  // 确认密码验证
  const confirmInput = document.getElementById('reg-confirm');
  confirmInput.addEventListener('input', function() {
    const password = passwordInput.value;
    const confirm = this.value;
    
    let confirmTips = document.getElementById('confirm-tips');
    if (!confirmTips) {
      confirmTips = document.createElement('div');
      confirmTips.id = 'confirm-tips';
      confirmTips.className = 'text-sm mt-1';
      this.parentNode.appendChild(confirmTips);
    }
    
    if (password && confirm && password !== confirm) {
      confirmTips.textContent = '✗ 两次输入的密码不一致';
      confirmTips.className = 'text-sm text-red-500 mt-1';
    } else if (password && confirm && password === confirm) {
      confirmTips.textContent = '✓ 密码一致';
      confirmTips.className = 'text-sm text-green-500 mt-1';
    } else {
      confirmTips.textContent = '';
    }
  });
  </script>
</body>
</html>