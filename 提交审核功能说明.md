# 提交审核功能说明

## 功能位置

提交审核功能位于 **my_stories.html** 页面的故事卡片中。

## 功能说明

### 1. 按钮显示条件
提交审核按钮只在以下情况下显示：
- 故事状态为 `draft`（草稿）时显示 **"提交审核"** 按钮
- 故事状态为 `rejected`（已拒绝）时显示 **"重新提交"** 按钮
- 故事状态为 `pending`（待审核）时显示灰色的 **"审核中"** 按钮（禁用状态）
- 故事状态为 `published`（已发布）时显示 **"取消发布"** 按钮

### 2. 按钮样式
```html
<!-- 草稿状态 - 提交审核按钮 -->
<button onclick="submitStory('${storyId}', '${title}')" 
    class="px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center text-sm">
    <i class="fa fa-paper-plane mr-2"></i> 提交审核
</button>

<!-- 被拒绝状态 - 重新提交按钮 -->
<button onclick="submitStory('${storyId}', '${title}')" 
    class="px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center text-sm">
    <i class="fa fa-paper-plane mr-2"></i> 重新提交
</button>

<!-- 待审核状态 - 审核中按钮（禁用） -->
<button disabled 
    class="px-3 py-2 bg-gray-300 text-gray-500 rounded-lg cursor-not-allowed flex items-center justify-center text-sm">
    <i class="fa fa-clock-o mr-2"></i> 审核中
</button>
```

### 3. 状态标识
```html
<!-- 草稿状态 -->
<span class="px-2 py-1 bg-progress/10 text-progress text-xs rounded-full">草稿</span>

<!-- 待审核状态 -->
<span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full">
    <i class="fa fa-clock-o mr-1"></i>待审核
</span>

<!-- 已发布状态 -->
<span class="px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full">
    <i class="fa fa-check-circle mr-1"></i>已发布
</span>

<!-- 已拒绝状态 -->
<span class="px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full">
    <i class="fa fa-times-circle mr-1"></i>已拒绝
</span>
```

## 使用流程

1. **用户登录**：访问 `http://localhost:8000/my_stories.html`
2. **查看作品**：页面会显示用户的所有故事，按状态分类
3. **提交审核**：
   - 对于草稿状态的故事，点击蓝色的 **"提交审核"** 按钮
   - 系统弹出确认对话框
   - 确认后故事状态变为"待审核"
4. **等待审核**：管理员在后台审核作品
5. **审核结果**：
   - 通过：状态变为"已发布"
   - 拒绝：状态变为"已拒绝"，可以重新提交

## API接口

### 提交审核接口
- **URL**: `PATCH /api/v1/stories/:storyId/submit`
- **认证**: 需要Bearer Token
- **权限**: 只有故事作者可以提交
- **限制**: 只有草稿或被拒绝状态的故事才能提交

### 响应示例
```json
{
  "success": true,
  "message": "故事提交审核成功",
  "data": {
    "id": "故事ID",
    "title": "故事标题",
    "status": "pending",
    "submittedAt": "2023-XX-XX"
  }
}
```

## 测试方法

1. 使用测试页面：`http://localhost:8000/test_submit_review.html`
2. 按照以下步骤测试：
   - 登录测试账户
   - 创建测试故事（默认为草稿状态）
   - 加载故事列表
   - 点击"提交审核"按钮测试功能

## 可能的问题

### 1. 没有看到提交审核按钮
- **原因**: 可能没有草稿状态的故事
- **解决**: 创建新故事或确保故事状态为draft

### 2. 按钮显示但点击无反应
- **原因**: 可能未登录或token过期
- **解决**: 重新登录获取有效token

### 3. 提交失败
- **原因**: 网络问题或服务器错误
- **解决**: 检查控制台错误信息，确认后端服务正常运行

## 管理员审核

管理员可以通过以下接口审核作品：
- **URL**: `PUT /api/v1/admin/stories/:storyId/review`
- **参数**: `{ "action": "approve" | "reject", "reason": "拒绝原因" }`

## 文件位置

- **前端页面**: `front/my_stories.html`
- **后端路由**: `backend/routes/stories.js` (第594行)
- **测试页面**: `front/test_submit_review.html`