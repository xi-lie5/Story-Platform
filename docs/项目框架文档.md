# StoryForge AI故事创作平台 - 项目框架文档

## 1. 项目架构概述

### 1.1 架构模式

StoryForge采用**前后端一体化架构**（Monolithic Architecture），使用Express.js同时提供API服务和静态文件服务。

```
┌─────────────────────────────────────────────────────────┐
│                    客户端浏览器                          │
│  (HTML/CSS/JavaScript - Tailwind CSS)                  │
└──────────────────┬──────────────────────────────────────┘
                   │ HTTP/HTTPS
                   │ RESTful API
┌──────────────────▼──────────────────────────────────────┐
│              Express.js 服务器                          │
│  ┌──────────────────────────────────────────────────┐  │
│  │  API路由层 (RESTful API)                         │  │
│  │  - /api/v1/auth                                 │  │
│  │  - /api/v1/stories                               │  │
│  │  - /api/v1/admin                                 │  │
│  │  - ...                                           │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────┐  │
│  │  中间件层 (Middleware)                           │  │
│  │  - 认证中间件 (authGuard)                       │  │
│  │  - 权限中间件 (adminGuard)                      │  │
│  │  - 错误处理中间件                                │  │
│  │  - 缓存中间件                                    │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────┐  │
│  │  业务逻辑层 (Models)                             │  │
│  │  - User, Story, StoryNode, Branch, ...           │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────┐  │
│  │  数据访问层 (Database)                            │  │
│  │  - MySQL连接池                                   │  │
│  │  - SQL查询                                       │  │
│  └──────────────────────────────────────────────────┘  │
└──────────────────┬──────────────────────────────────────┘
                   │
┌──────────────────▼──────────────────────────────────────┐
│              MySQL 数据库                               │
│  - users (用户表)                                       │
│  - stories (故事表)                                     │
│  - story_nodes (节点表)                                 │
│  - branches (分支表)                                    │
│  - categories (分类表)                                  │
│  - ...                                                  │
└─────────────────────────────────────────────────────────┘
```

### 1.2 技术栈

#### 后端技术栈
- **运行环境**: Node.js (v14.0.0+)
- **Web框架**: Express.js (v5.1.0)
- **数据库**: MySQL 8.0+
- **ORM/数据库驱动**: mysql2 (v3.11.0)
- **认证**: jsonwebtoken (v9.0.2)
- **密码加密**: bcryptjs (v3.0.2)
- **输入验证**: express-validator (v7.3.0)
- **安全**: helmet (v7.2.0)
- **日志**: morgan (v1.10.1)
- **缓存**: node-cache (v5.1.2)
- **AI服务**: dashscope (v1.0.1) - 阿里云通义千问
- **HTTP客户端**: axios (v1.12.2)
- **环境变量**: dotenv (v17.2.3)

#### 前端技术栈
- **HTML**: HTML5
- **CSS**: Tailwind CSS (CDN)
- **JavaScript**: ES6+
- **图标库**: Font Awesome 6.4.0
- **字体**: Inter (Google Fonts)

#### 开发工具
- **包管理**: npm
- **代码规范**: ESLint (v9.12.0)
- **开发服务器**: nodemon (v3.1.7)

---

## 2. 项目目录结构

```
Story-Platform-main/
│
├── backend/                    # 后端代码目录
│   ├── avatar/                 # 用户头像存储目录
│   │   └── default.png        # 默认头像
│   │
│   ├── coverImage/            # 故事封面存储目录
│   │   └── 1.png              # 默认封面
│   │
│   ├── config/                # 配置文件目录
│   │   └── database.js        # 数据库配置和连接池
│   │
│   ├── middleware/            # 中间件目录
│   │   ├── adminAuth.js       # 管理员权限验证中间件
│   │   ├── auth.js            # 用户认证中间件
│   │   ├── cache.js           # 缓存中间件
│   │   ├── errorHandler.js   # 错误处理中间件
│   │   ├── refreshAuth.js    # Token刷新中间件
│   │   └── storyAuth.js       # 故事权限验证中间件
│   │
│   ├── models/                # 数据模型目录
│   │   ├── Branch.js          # 分支模型
│   │   ├── Category.js        # 分类模型
│   │   ├── Character.js       # 角色模型
│   │   ├── Collection.js      # 收藏模型
│   │   ├── Story.js           # 故事模型
│   │   ├── StoryNode.js       # 故事节点模型
│   │   ├── User.js            # 用户模型
│   │   ├── UserStoryFavorite.js  # 用户故事收藏模型
│   │   └── UserStoryRating.js    # 用户故事评分模型
│   │
│   ├── routes/                # 路由目录
│   │   ├── admin.js           # 管理员路由
│   │   ├── ai.js              # AI功能路由
│   │   ├── auth.js            # 认证路由
│   │   ├── branches.js        # 分支路由
│   │   ├── categories.js     # 分类路由
│   │   ├── characters.js     # 角色路由
│   │   ├── interactions.js   # 用户交互路由（收藏、评分）
│   │   ├── stories.js        # 故事路由
│   │   ├── storyNodes.js     # 节点路由
│   │   └── users.js          # 用户路由
│   │
│   ├── scripts/               # 脚本目录
│   │   ├── checkAdmin.js     # 检查管理员账户脚本
│   │   ├── createAdmin.js    # 创建管理员脚本
│   │   ├── createTestStory.js # 创建测试故事脚本
│   │   └── resetAdminPassword.js # 重置管理员密码脚本
│   │
│   ├── utils/                 # 工具函数目录
│   │   ├── errorFormat.js    # 错误格式化工具
│   │   ├── idValidator.js    # ID验证工具
│   │   └── pagination.js     # 分页工具
│   │
│   ├── .env                   # 环境变量配置文件
│   ├── server.js              # 服务器入口文件
│   ├── package.json           # 后端依赖配置
│   └── package-lock.json      # 依赖锁定文件
│
├── front/                      # 前端代码目录
│   ├── assets/                # 静态资源目录
│   │   ├── img/              # 图片资源
│   │   │   └── default-avatar.png
│   │   └── js/               # JavaScript文件
│   │       ├── api-config.js # API配置
│   │       ├── auth.js       # 认证相关JS
│   │       └── navbar.js     # 导航栏JS
│   │
│   ├── admin.html             # 管理员控制台页面
│   ├── browse.html            # 故事浏览页面
│   ├── create.html            # 故事创建页面
│   ├── forgot_password.html   # 忘记密码页面
│   ├── index.html             # 首页
│   ├── login.html             # 登录页面
│   ├── my_stories.html        # 我的作品页面
│   ├── profile.html           # 个人中心页面
│   ├── register.html          # 注册页面
│   ├── review.html            # 故事审核页面
│   ├── story-reader.html      # 故事阅读器页面
│   ├── script.js              # 通用脚本文件
│   ├── styles.css             # 自定义样式文件
│   └── start_server.bat      # Windows启动脚本
│
├── docs/                       # 文档目录
│   ├── API文档.md             # API接口文档
│   ├── 前端功能需求文档.md    # 前端需求文档
│   ├── 需求分析文档.md        # 需求分析文档
│   └── 项目框架文档.md        # 项目框架文档（本文件）
│
├── models/                     # 旧模型目录（可能已废弃）
│   ├── Branches.js
│   ├── Characters.js
│   ├── Nodes.js
│   └── Stories.js
│
├── LICENSE                     # 许可证文件
├── README.md                   # 项目说明文件
└── nav_content.txt            # 导航内容文件
```

---

## 3. 核心模块架构

### 3.1 后端模块架构

#### 3.1.1 路由层 (Routes)

路由层负责处理HTTP请求，调用相应的业务逻辑。

**路由组织方式**:
```
/api/v1/
├── auth/              # 认证相关
│   ├── POST /register
│   ├── POST /login
│   ├── POST /refresh
│   └── POST /logout
│
├── stories/           # 故事相关
│   ├── GET /          # 获取故事列表
│   ├── GET /:id       # 获取故事详情
│   ├── POST /         # 创建故事
│   ├── PUT /:id       # 更新故事
│   └── DELETE /:id   # 删除故事
│
├── storyNodes/        # 节点相关
│   ├── GET /stories/:storyId/nodes
│   ├── POST /stories/:storyId/nodes
│   └── PUT /nodes/:nodeId
│
├── admin/             # 管理员功能
│   ├── GET /stats
│   ├── GET /stories
│   └── PUT /stories/:id/review
│
└── ...
```

**路由特点**:
- RESTful API设计
- 统一的错误处理
- 统一的响应格式
- 中间件链式调用

#### 3.1.2 中间件层 (Middleware)

中间件层提供横切关注点（Cross-cutting Concerns）的处理。

**中间件列表**:

1. **auth.js** - 用户认证中间件
   - 验证JWT Token
   - 解析用户信息
   - 设置 `req.user`

2. **adminAuth.js** - 管理员权限中间件
   - 验证用户角色
   - 检查是否为管理员
   - 拒绝非管理员访问

3. **storyAuth.js** - 故事权限中间件
   - 验证故事所有权
   - 检查用户是否有权限操作故事

4. **cache.js** - 缓存中间件
   - 缓存GET请求响应
   - 支持TTL设置
   - 缓存失效机制

5. **errorHandler.js** - 错误处理中间件
   - 统一错误格式
   - 错误日志记录
   - 错误响应格式化

6. **refreshAuth.js** - Token刷新中间件
   - 验证Refresh Token
   - 生成新的Access Token

**中间件执行顺序**:
```
请求 → CORS → JSON解析 → 路由匹配 → 认证中间件 → 权限中间件 → 业务逻辑 → 错误处理 → 响应
```

#### 3.1.3 模型层 (Models)

模型层封装数据库操作，提供面向对象的数据访问接口。

**模型设计模式**:
- **Active Record模式**: 模型包含数据和行为
- **静态方法**: 提供类级别的操作（如 `User.create()`, `Story.findById()`）
- **实例方法**: 提供实例级别的操作（如 `user.save()`, `user.matchPassword()`）

**模型列表**:

1. **User.js** - 用户模型
   - 用户CRUD操作
   - 密码加密和验证
   - 登录尝试限制
   - Token管理

2. **Story.js** - 故事模型
   - 故事CRUD操作
   - 状态管理
   - 关联查询（作者、分类）

3. **StoryNode.js** - 节点模型
   - 节点CRUD操作
   - 批量保存
   - 节点关系处理

4. **Branch.js** - 分支模型
   - 分支CRUD操作
   - 批量创建
   - 分支查询（出向、入向）

5. **Category.js** - 分类模型
   - 分类CRUD操作
   - 故事数量统计

6. **Character.js** - 角色模型
   - 角色CRUD操作
   - 批量操作

7. **UserStoryFavorite.js** - 收藏模型
   - 收藏/取消收藏
   - 收藏列表查询

8. **UserStoryRating.js** - 评分模型
   - 评分创建/更新
   - 评分统计

**模型特点**:
- 统一的错误处理
- 参数验证
- SQL注入防护（参数化查询）
- 事务支持

#### 3.1.4 数据访问层 (Database)

数据访问层使用MySQL连接池管理数据库连接。

**连接池配置**:
```javascript
{
  host: 'localhost',
  port: 3306,
  user: 'root',
  password: 'password',
  database: 'story_platform',
  connectionLimit: 10,
  waitForConnections: true,
  queueLimit: 0,
  charset: 'utf8mb4'
}
```

**数据库操作模式**:
- 使用Prepared Statements防止SQL注入
- 连接池管理，避免连接泄漏
- 事务支持，保证数据一致性
- 字符集设置为utf8mb4，支持emoji等特殊字符

---

### 3.2 前端模块架构

#### 3.2.1 页面结构

前端采用**多页面应用（MPA）**架构，每个功能模块对应一个HTML页面。

**页面列表**:

1. **index.html** - 首页
   - 平台介绍
   - 功能展示
   - 导航入口

2. **login.html** - 登录页
   - 用户登录表单
   - 忘记密码链接

3. **register.html** - 注册页
   - 用户注册表单
   - 表单验证

4. **browse.html** - 故事浏览页
   - 故事列表展示
   - 搜索和筛选
   - 分页

5. **story-reader.html** - 故事阅读器
   - 节点内容展示
   - 分支选择
   - 阅读设置

6. **create.html** - 故事创建页
   - 可视化编辑器
   - 节点管理
   - 实时预览

7. **my_stories.html** - 我的作品页
   - 作品列表
   - 状态筛选
   - 操作按钮

8. **profile.html** - 个人中心
   - 个人信息
   - 创作统计
   - 管理中心（管理员）

9. **admin.html** - 管理员控制台
   - 数据统计
   - 作品管理
   - 用户管理

10. **review.html** - 故事审核页
    - 待审核故事列表
    - 审核操作

#### 3.2.2 JavaScript模块

**核心JS文件**:

1. **assets/js/auth.js** - 认证模块
   - Token管理
   - 登录状态检查
   - 自动刷新Token
   - 登出功能

2. **assets/js/navbar.js** - 导航栏模块
   - 动态导航链接
   - 用户角色判断
   - 响应式菜单

3. **assets/js/api-config.js** - API配置
   - API基础URL配置
   - 请求拦截器
   - 响应拦截器

4. **script.js** - 通用脚本
   - 工具函数
   - 通用UI组件
   - 事件处理

**前端架构特点**:
- 原生JavaScript，无框架依赖
- 模块化组织（按功能划分）
- 统一的API调用方式
- 响应式设计（Tailwind CSS）

---

## 4. 数据流架构

### 4.1 请求处理流程

```
用户操作
  ↓
前端JavaScript
  ↓
HTTP请求 (Fetch API)
  ↓
Express服务器
  ↓
中间件链
  ├── CORS处理
  ├── JSON解析
  ├── 认证验证
  └── 权限检查
  ↓
路由处理
  ↓
业务逻辑 (Models)
  ↓
数据库操作 (MySQL)
  ↓
响应数据
  ↓
JSON格式化
  ↓
HTTP响应
  ↓
前端处理
  ↓
UI更新
```

### 4.2 认证流程

```
用户登录
  ↓
POST /api/v1/auth/login
  ↓
验证邮箱和密码
  ↓
生成JWT Token
  ├── Access Token (1天)
  └── Refresh Token (7天)
  ↓
返回Token给前端
  ↓
前端存储Token (localStorage/sessionStorage)
  ↓
后续请求携带Token
  ↓
中间件验证Token
  ↓
允许/拒绝访问
```

### 4.3 数据持久化流程

```
用户操作
  ↓
前端表单提交
  ↓
API请求
  ↓
后端验证
  ↓
模型层处理
  ↓
SQL执行
  ↓
数据库更新
  ↓
返回结果
  ↓
前端更新UI
```

---

## 5. 安全架构

### 5.1 认证安全

**JWT Token机制**:
- Access Token: 短期有效（1天），用于API访问
- Refresh Token: 长期有效（7天），用于刷新Access Token
- Token版本控制: 支持强制登出（通过token_version字段）

**密码安全**:
- 使用bcrypt加密，salt rounds = 10
- 密码不返回给前端
- 登录失败次数限制（5次锁定30分钟）

**账户安全**:
- 账户锁定机制
- 账户禁用功能（管理员）
- 密码重置功能（管理员）

### 5.2 数据安全

**SQL注入防护**:
- 使用Prepared Statements
- 参数化查询
- 输入验证

**XSS防护**:
- 输入验证和清理
- 输出转义
- Content Security Policy（CSP）

**CSRF防护**:
- 使用JWT Token（不依赖Cookie）
- SameSite Cookie设置

**敏感信息保护**:
- 密码不存储在客户端
- Token存储在localStorage/sessionStorage
- 环境变量管理敏感配置

### 5.3 权限控制

**角色定义**:
- `user`: 普通用户
- `editor`: 编辑（预留）
- `admin`: 管理员

**权限检查**:
- 路由级别权限检查（中间件）
- 资源级别权限检查（业务逻辑）
- 操作级别权限检查（API接口）

**权限矩阵**:

| 功能 | 访客 | 用户 | 管理员 |
|------|------|------|--------|
| 浏览故事 | ✓ | ✓ | ✓ |
| 阅读故事 | ✓ | ✓ | ✓ |
| 创建故事 | ✗ | ✓ | ✓ |
| 编辑自己的故事 | ✗ | ✓ | ✓ |
| 审核故事 | ✗ | ✗ | ✓ |
| 管理用户 | ✗ | ✗ | ✓ |
| 管理分类 | ✗ | ✗ | ✓ |

---

## 6. 缓存架构

### 6.1 缓存策略

**缓存位置**: 服务器内存（node-cache）

**缓存内容**:
- 故事列表（TTL: 5分钟）
- 故事详情（TTL: 3分钟）
- 分类列表（TTL: 5分钟）
- 用户统计（TTL: 1分钟）

**缓存失效**:
- 时间过期（TTL）
- 主动清除（更新/删除操作时）

**缓存键格式**:
```
story:list:{page}:{limit}:{category}:{search}:{sort}
story:detail:{storyId}
category:list
user:stats:{userId}
```

### 6.2 缓存流程

```
请求到达
  ↓
检查缓存
  ↓
缓存命中？
  ├── 是 → 返回缓存数据
  └── 否 → 查询数据库
         ↓
         更新缓存
         ↓
         返回数据
```

---

## 7. 错误处理架构

### 7.1 错误分类

**错误类型**:
- 验证错误（400）
- 认证错误（401）
- 权限错误（403）
- 资源不存在（404）
- 服务器错误（500）

### 7.2 错误处理流程

```
错误发生
  ↓
捕获错误
  ↓
错误格式化 (errorFormat)
  ├── 错误码
  ├── 错误消息
  └── 错误详情
  ↓
错误日志记录
  ↓
错误响应
  ↓
前端错误处理
  ↓
用户提示
```

### 7.3 统一错误格式

```json
{
  "success": false,
  "message": "错误描述",
  "errors": [
    {
      "field": "字段名",
      "message": "字段错误信息"
    }
  ],
  "code": 10001,
  "timestamp": "2024-01-01T00:00:00.000Z"
}
```

---

## 8. 数据库架构

### 8.1 数据库设计

**数据库**: MySQL 8.0+

**字符集**: utf8mb4

**存储引擎**: InnoDB

### 8.2 表关系图

```
users (用户)
  ├── stories (故事) [1:N]
  │     ├── story_nodes (节点) [1:N]
  │     │     ├── branches (分支) [1:N] (source)
  │     │     └── branches (分支) [1:N] (target)
  │     ├── characters (角色) [1:N]
  │     ├── user_story_favorites (收藏) [1:N]
  │     └── user_story_ratings (评分) [1:N]
  └── categories (分类) [1:N]
        └── stories (故事) [1:N]
```

### 8.3 索引策略

**主键索引**:
- 所有表都有自增主键 `id`

**唯一索引**:
- `users.username`
- `users.email`
- `categories.name`
- `user_story_favorites (user_id, story_id)`
- `user_story_ratings (user_id, story_id)`

**普通索引**:
- `stories.author_id`
- `stories.category_id`
- `stories.status`
- `story_nodes.story_id`
- `branches.source_node_id`
- `branches.target_node_id`

**全文索引**:
- `stories (title, description)` - 用于搜索

---

## 9. API架构

### 9.1 RESTful API设计

**设计原则**:
- 资源导向（Resource-oriented）
- 使用HTTP动词（GET, POST, PUT, DELETE, PATCH）
- 统一的URL格式
- 统一的响应格式

**URL命名规范**:
```
/api/v1/{resource}
/api/v1/{resource}/{id}
/api/v1/{resource}/{id}/{sub-resource}
```

**HTTP方法使用**:
- `GET`: 查询资源
- `POST`: 创建资源
- `PUT`: 更新资源（完整更新）
- `PATCH`: 更新资源（部分更新）
- `DELETE`: 删除资源

### 9.2 API版本控制

**当前版本**: v1

**版本标识**: URL路径中（`/api/v1/`）

**版本升级策略**: 向后兼容，新版本使用新路径

---

## 10. 部署架构

### 10.1 部署模式

**单机部署**:
- 前后端一体化
- Express同时提供API和静态文件服务
- 单进程运行

**部署结构**:
```
服务器
  ├── Node.js进程
  │   ├── Express服务器
  │   ├── API路由
  │   └── 静态文件服务
  │
  ├── MySQL数据库
  │   └── 数据存储
  │
  └── 文件存储
      ├── 用户头像
      └── 故事封面
```

### 10.2 环境配置

**开发环境**:
- 本地开发服务器
- 开发数据库
- 调试模式

**生产环境**:
- 生产服务器
- 生产数据库
- 日志记录
- 错误监控

### 10.3 启动流程

```
1. 加载环境变量 (.env)
   ↓
2. 初始化Express应用
   ↓
3. 配置中间件
   ↓
4. 连接数据库
   ↓
5. 初始化数据库表
   ↓
6. 注册路由
   ↓
7. 启动服务器
   ↓
8. 监听端口
```

---

## 11. 开发规范

### 11.1 代码组织

**文件命名**:
- 使用驼峰命名（camelCase）
- 模型文件首字母大写（如 `User.js`）
- 路由文件小写（如 `auth.js`）

**目录结构**:
- 按功能模块划分
- 相关文件放在同一目录
- 工具函数独立目录

### 11.2 编码规范

**JavaScript**:
- 使用ES6+语法
- 使用async/await处理异步
- 使用const/let，避免var
- 函数命名清晰

**SQL**:
- 使用Prepared Statements
- 参数化查询
- 避免字符串拼接

**注释**:
- 函数注释说明参数和返回值
- 复杂逻辑添加注释
- API接口添加注释

### 11.3 Git工作流

**分支策略**:
- `main`: 主分支（生产环境）
- `develop`: 开发分支
- `feature/*`: 功能分支
- `fix/*`: 修复分支

**提交规范**:
- 提交信息清晰
- 一次提交一个功能
- 提交前运行测试

---

## 12. 性能优化

### 12.1 数据库优化

**查询优化**:
- 使用索引
- 避免全表扫描
- 使用LIMIT限制结果集
- 使用JOIN替代多次查询

**连接优化**:
- 使用连接池
- 及时释放连接
- 设置合理的连接数

### 12.2 缓存优化

**缓存策略**:
- 缓存热点数据
- 设置合理的TTL
- 及时清除过期缓存

**缓存内容**:
- 故事列表
- 故事详情
- 分类列表

### 12.3 前端优化

**资源优化**:
- 使用CDN加载外部资源
- 图片懒加载
- 代码压缩

**请求优化**:
- 减少HTTP请求
- 使用分页加载
- 防抖和节流

---

## 13. 扩展性设计

### 13.1 水平扩展

**当前限制**:
- 单机部署
- 单进程运行

**扩展方案**:
- 使用PM2进行进程管理
- 使用Nginx进行负载均衡
- 数据库读写分离
- Redis缓存集群

### 13.2 功能扩展

**预留接口**:
- 第三方登录（OAuth）
- 消息通知系统
- 评论系统
- 关注/粉丝系统

**模块化设计**:
- 路由模块化
- 模型模块化
- 中间件模块化

---

## 14. 监控和日志

### 14.1 日志记录

**日志类型**:
- 访问日志（morgan）
- 错误日志
- 业务日志

**日志内容**:
- 请求信息
- 响应信息
- 错误堆栈
- 执行时间

### 14.2 监控指标

**系统指标**:
- CPU使用率
- 内存使用率
- 数据库连接数

**业务指标**:
- API响应时间
- 错误率
- 用户活跃度

---

## 15. 测试策略

### 15.1 测试类型

**单元测试**:
- 模型方法测试
- 工具函数测试

**集成测试**:
- API接口测试
- 数据库操作测试

**端到端测试**:
- 用户流程测试
- 功能完整性测试

### 15.2 测试工具

**推荐工具**:
- Jest（单元测试）
- Supertest（API测试）
- Mocha（测试框架）

---

## 16. 文档体系

### 16.1 文档列表

1. **需求分析文档** - 功能需求详细说明
2. **API文档** - API接口详细说明
3. **项目框架文档** - 项目架构和设计（本文件）
4. **前端功能需求文档** - 前端功能需求

### 16.2 文档维护

**更新频率**:
- 功能变更时更新
- 架构调整时更新
- 定期审查和更新

**文档规范**:
- 使用Markdown格式
- 结构清晰
- 示例完整

---

## 17. 总结

StoryForge项目采用前后端一体化的架构设计，使用现代化的技术栈，提供了完整的AI故事创作平台功能。

**架构特点**:
1. **简单高效**: 单机部署，易于维护
2. **模块化设计**: 代码组织清晰，易于扩展
3. **安全可靠**: 完善的认证和权限控制
4. **性能优化**: 缓存机制，数据库优化
5. **文档完善**: 详细的文档支持

**技术亮点**:
1. JWT认证机制
2. RESTful API设计
3. 缓存优化
4. 错误处理机制
5. 数据库连接池

**未来优化方向**:
1. 引入Redis缓存
2. 数据库读写分离
3. 微服务架构改造
4. 容器化部署
5. 自动化测试

---

## 附录

### A. 环境变量配置

```env
# 数据库配置
MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_USER=root
MYSQL_PASSWORD=your_password
MYSQL_DATABASE=story_platform

# JWT配置
JWT_SECRET=your_jwt_secret_min_32_chars
JWT_REFRESH_SECRET=your_refresh_secret_min_32_chars
JWT_EXPIRES_IN=1d
JWT_REFRESH_EXPIRES_IN=7d

# AI服务配置
DASHSCOPE_API_KEY=your_dashscope_api_key

# 服务器配置
PORT=5000
CLIENT_ORIGIN=http://localhost:5000
```

### B. 依赖包列表

**后端依赖**:
- express
- mysql2
- jsonwebtoken
- bcryptjs
- express-validator
- dotenv
- cors
- helmet
- morgan
- node-cache
- dashscope
- axios

**开发依赖**:
- nodemon
- eslint

### C. 数据库表结构

详见 `需求分析文档.md` 第4章数据库设计部分。

---

**文档版本**: v1.0.0  
**最后更新**: 2024-01-01  
**维护者**: StoryForge开发团队
